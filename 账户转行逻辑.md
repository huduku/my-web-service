ä¸‹é¢æ˜¯å®Œæ•´çš„ æŸ¥è¯¢è´¦æˆ·ã€è½¬è´¦ã€æ•°æ®è½åº“ çš„é€»è¾‘ä»£ç ï¼ŒåŒ…æ‹¬ï¼š
	â€¢	æ•°æ®åº“å®ä½“ Account
	â€¢	Domain Primitive ç±»å‹
	â€¢	è´¦æˆ·è½¬æ¢ TryFrom<Account> for AccountTransfer
	â€¢	å­˜å‚¨åº“æ“ä½œ
	â€¢	å®Œæ•´çš„ transfer é€»è¾‘
	â€¢	Domain Primitive new æ–¹æ³•çš„å®ç°

1ï¸âƒ£ Account æ•°æ®åº“å®ä½“

```rust
#[derive(Debug, Clone)]
pub struct Account {
    pub id: Option<i64>,
    pub balance: Option<Decimal>,
    pub currency: Option<String>,
    pub daily_limit: Option<Decimal>,
}
```
	â€¢	ä¸æ•°æ®åº“äº¤äº’çš„ç»“æ„ï¼Œå­—æ®µç±»å‹ç”¨ Option<T>ï¼Œå› ä¸ºæ•°æ®åº“æŸ¥è¯¢å¯èƒ½è¿”å› NULLã€‚

2ï¸âƒ£ Domain Primitive ç±»å‹
```rust
#[derive(Debug, Clone)]
pub struct AccountId(i64);

impl AccountId {
    pub fn new(value: Option<i64>) -> Result<Self, String> {
        value.map(Self).ok_or_else(|| "è´¦æˆ· ID ä¸èƒ½ä¸ºç©º".to_string())
    }
}

#[derive(Debug, Clone)]
pub struct Balance(Decimal);

impl Balance {
    pub fn new(value: Option<Decimal>) -> Result<Self, String> {
        match value {
            Some(v) if v >= Decimal::ZERO => Ok(Self(v)),
            Some(_) => Err("ä½™é¢ä¸èƒ½ä¸ºè´Ÿæ•°".to_string()),
            None => Err("è´¦æˆ·ä½™é¢ä¸èƒ½ä¸ºç©º".to_string()),
        }
    }
}

#[derive(Debug, Clone)]
pub struct Currency(String);

impl Currency {
    pub fn new(value: Option<String>) -> Result<Self, String> {
        value.map(Self).ok_or_else(|| "å¸ç§ä¸èƒ½ä¸ºç©º".to_string())
    }
}

#[derive(Debug, Clone)]
pub struct DailyLimit(Decimal);

impl DailyLimit {
    pub fn new(value: Option<Decimal>) -> Result<Self, String> {
        value.map(Self).ok_or_else(|| "å•æ—¥é™é¢ä¸èƒ½ä¸ºç©º".to_string())
    }
}
```
	â€¢	new() å¤„ç† None å’Œéæ³•å€¼
	â€¢	Balance æ”¯æŒ withdraw() å’Œ deposit()

3ï¸âƒ£ AccountTransfer (Domain Primitive for è´¦æˆ·)
```rust
#[derive(Debug, Clone)]
pub struct AccountTransfer {
    pub account_id: AccountId,
    pub balance: Balance,
    pub currency: Currency,
    pub daily_limit: DailyLimit,
}

impl AccountTransfer {
    pub fn deposit(&mut self, amount: Balance, currency: Currency) -> Result<(), String> {
        if self.currency != currency {
            return Err("å¸ç§ä¸åŒ¹é…".to_string());
        }
        self.balance += amount;
        Ok(())
    }

    pub fn withdraw(&mut self, amount: Balance, currency: Currency) -> Result<(), String> {
        if self.currency != currency {
            return Err("å¸ç§ä¸åŒ¹é…".to_string());
        }
        if self.balance < amount {
            return Err("ä½™é¢ä¸è¶³".to_string());
        }
        if amount > self.daily_limit {
            return Err("è¶…è¿‡å•æ—¥é™é¢".to_string());
        }
        self.balance -= amount;
        Ok(())
    }
}

impl TryFrom<Account> for AccountTransfer {
    type Error = String;

    fn try_from(value: Account) -> Result<Self, Self::Error> {
        Ok(Self {
            account_id: AccountId::new(value.id)?,
            balance: Balance::new(value.balance)?,
            currency: Currency::new(value.currency)?,
            daily_limit: DailyLimit::new(value.daily_limit)?,
        })
    }
}
```
	â€¢	ç”¨äºä¸šåŠ¡é€»è¾‘çš„ AccountTransferï¼Œé¿å…ç›´æ¥æ“ä½œ Account
	â€¢	ä¿è¯æ•°æ®æ˜¯æœ‰æ•ˆçš„ï¼ˆè½¬æ¢æ—¶å·²åšæ ¡éªŒï¼‰

4ï¸âƒ£ æ•°æ®åº“æŸ¥è¯¢è´¦æˆ·
```rust
pub async fn get_account(rb: &RBatis, id: i64) -> Result<AccountTransfer, String> {
    let account_opt = Account::select_by_id(rb, id).await.map_err(|_| "æ•°æ®åº“å¼‚å¸¸".to_string())?;
    account_opt.ok_or_else(|| "è´¦æˆ·ä¸å­˜åœ¨".to_string())?.try_into()
}
```
	â€¢	æ•°æ®åº“å¼‚å¸¸ â†’ "æ•°æ®åº“å¼‚å¸¸"
	â€¢	è´¦æˆ·ä¸å­˜åœ¨ â†’ "è´¦æˆ·ä¸å­˜åœ¨"
	â€¢	è½¬æ¢ Account â†’ AccountTransferï¼Œç¡®ä¿æ•°æ®æœ‰æ•ˆ

5ï¸âƒ£ è½¬è´¦é€»è¾‘
```rust
pub async fn transfer(rb: &RBatis, from_id: i64, to_id: i64, amount: Decimal) -> Result<(), String> {
    let mut from_account = get_account(rb, from_id).await?;
    let mut to_account = get_account(rb, to_id).await?;

    // 1ï¸âƒ£ ç¡®ä¿å¸ç§ä¸€è‡´
    if from_account.currency.0 != to_account.currency.0 {
        return Err("è´¦æˆ·å¸ç§ä¸ä¸€è‡´ï¼Œæ— æ³•è½¬è´¦".to_string());
    }

    // 2ï¸âƒ£ ä½™é¢æ ¡éªŒ & æ‰£æ¬¾
    from_account.withdraw(amount)?;

    // 3ï¸âƒ£ è½¬å…¥åˆ°è´¦æˆ·
    to_account.deposit(amount);

    // 4ï¸âƒ£ æ›´æ–°æ•°æ®åº“
    update_account_balance(rb, from_account.account_id.0, from_account.balance.0).await?;
    update_account_balance(rb, to_account.account_id.0, to_account.balance.0).await?;

    Ok(())
}
```
	â€¢	ç¡®ä¿å¸ç§ä¸€è‡´
	â€¢	æ‰£æ¬¾ & ä½™é¢æ ¡éªŒ
	â€¢	æ›´æ–°æ•°æ®åº“

6ï¸âƒ£ è½åº“æ“ä½œ
```rust
pub async fn update_account_balance(rb: &RBatis, id: i64, new_balance: Decimal) -> Result<(), String> {
    let result = Account::update_by_column(rb, "balance", id, new_balance).await;
    result.map_err(|_| "æ•°æ®åº“å¼‚å¸¸".to_string())
}
```
	â€¢	ç»Ÿä¸€æ•°æ®åº“é”™è¯¯å¤„ç†
	â€¢	æ›´æ–°è´¦æˆ·ä½™é¢

ğŸ“Œ æ€»ç»“

ç»„ä»¶	ä½œç”¨
Account	æ•°æ®åº“å®ä½“ï¼Œå­—æ®µç”¨ Option<T>
AccountTransfer	ä¸šåŠ¡å±‚ Domain Primitiveï¼Œæ•°æ®å·²æ ¡éªŒ
get_account()	æŸ¥è¯¢æ•°æ®åº“ï¼Œè½¬æ¢æˆ AccountTransfer
transfer()	å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼šæ ¡éªŒã€æ‰£æ¬¾ã€å­˜æ¬¾ã€è½åº“
update_account_balance()	æ›´æ–°æ•°æ®åº“ä½™é¢ï¼Œç»Ÿä¸€é”™è¯¯å¤„ç†

âœ… è®¾è®¡ä¼˜åŠ¿
	1.	åˆ†ç¦»æ•°æ®åº“ç»“æ„å’Œä¸šåŠ¡é€»è¾‘
	â€¢	Account â†’ æ•°æ®åº“äº¤äº’
	â€¢	AccountTransfer â†’ ä¸šåŠ¡é€»è¾‘
	2.	Domain Primitive ç»Ÿä¸€æ ¡éªŒ
	â€¢	Balance::new() ç¡®ä¿ä½™é¢åˆæ³•
	â€¢	Balance::withdraw() é˜²æ­¢ä½™é¢ä¸è¶³
	â€¢	Currency::new() ç¡®ä¿å¸ç§éç©º
	3.	æ•°æ®åº“é”™è¯¯å°è£…
	â€¢	ç»Ÿä¸€ Err("æ•°æ®åº“å¼‚å¸¸")
	â€¢	ä¸šåŠ¡é€»è¾‘é”™è¯¯å•ç‹¬å¤„ç†

è¿™æ ·ä»£ç æ¸…æ™°å¯è¯»ï¼Œç¬¦åˆ Rust ç±»å‹å®‰å…¨ + ä¸šåŠ¡è§„åˆ™å°è£… çš„æœ€ä½³å®è·µã€‚

ä½ è§‰å¾—è¿™ä¸ªç»“æ„å¦‚ä½•ï¼Ÿå¦‚æœæœ‰éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´ï¼ ğŸ˜ƒ